<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Extensions &mdash; Kit 0.1 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.1',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Kit 0.1 documentation" href="index.html" />
    <link rel="next" title="Utilities" href="util.html" />
    <link rel="prev" title="Quickstart" href="api.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Kit 0.1 documentation</span></a></h1>
        <h2 class="heading"><span>Extensions</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="api.html">Quickstart</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="util.html">Utilities</a>&#160;&#160;»
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="extensions">
<h1>Extensions<a class="headerlink" href="#extensions" title="Permalink to this headline">¶</a></h1>
<div class="section" id="module-kit.ext.orm">
<span id="orm"></span><h2>ORM<a class="headerlink" href="#module-kit.ext.orm" title="Permalink to this headline">¶</a></h2>
<p>ORM Extension</p>
<p>This extension provides a customized SQLAlchemy model base and query.</p>
<p>Setup is straightforward:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">kit</span> <span class="kn">import</span> <span class="n">current_project</span> <span class="k">as</span> <span class="n">pj</span>
<span class="kn">from</span> <span class="nn">kit.ext</span> <span class="kn">import</span> <span class="n">ORM</span>

<span class="n">orm</span> <span class="o">=</span> <span class="n">ORM</span><span class="p">(</span><span class="n">pj</span><span class="p">)</span>

<span class="n">Model</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">Model</span>                 <span class="c"># the customized base</span>
<span class="n">relationship</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">relationship</span>   <span class="c"># the customized relationship</span>
<span class="n">backref</span> <span class="o">=</span> <span class="n">orm</span><span class="o">.</span><span class="n">backref</span>             <span class="c"># the associated backref</span>
</pre></div>
</div>
<p>Models can now be created by subclassing <tt class="docutils literal"><span class="pre">orm.Model</span></tt> as follows:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">sqlalchemy</span> <span class="kn">import</span> <span class="n">Column</span><span class="p">,</span> <span class="n">ForeignKey</span><span class="p">,</span> <span class="n">Integer</span><span class="p">,</span> <span class="n">String</span>

<span class="k">class</span> <span class="nc">House</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>

  <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">address</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">128</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">Cat</span><span class="p">(</span><span class="n">Model</span><span class="p">):</span>
    
  <span class="nb">id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">Integer</span><span class="p">,</span> <span class="n">primary_key</span><span class="o">=</span><span class="bp">True</span><span class="p">)</span>
  <span class="n">name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">String</span><span class="p">(</span><span class="mi">64</span><span class="p">))</span>
  <span class="n">house_id</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">ForeignKey</span><span class="p">(</span><span class="s">&#39;houses.id&#39;</span><span class="p">))</span>

  <span class="n">house</span> <span class="o">=</span> <span class="n">relationship</span><span class="p">(</span><span class="s">&#39;House&#39;</span><span class="p">,</span> <span class="n">backref</span><span class="o">=</span><span class="n">backref</span><span class="p">(</span><span class="s">&#39;cats&#39;</span><span class="p">,</span> <span class="n">lazy</span><span class="o">=</span><span class="s">&#39;dynamic&#39;</span><span class="p">))</span>
</pre></div>
</div>
<p>Note that tablenames are automatically generated by default. For an
exhaustive list of all the properties and methods provided by <tt class="docutils literal"><span class="pre">orm.Model</span></tt>
please refer to the documentation for <tt class="xref py py-class docutils literal"><span class="pre">kit.util._sqlalchemy.Model</span></tt>.</p>
<p>Models can be queried in several ways:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># the two following queries are equivalent</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">pj</span><span class="o">.</span><span class="n">session</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">Cat</span><span class="p">)</span>
<span class="n">query</span> <span class="o">=</span> <span class="n">Cat</span><span class="o">.</span><span class="n">q</span>
</pre></div>
</div>
<p>Both queries above are instances of <a class="reference internal" href="#kit.ext.orm.Query" title="kit.ext.orm.Query"><tt class="xref py py-class docutils literal"><span class="pre">kit.ext.orm.Query</span></tt></a>, which are
customized <tt class="docutils literal"><span class="pre">sqlalchemy.orm.Query</span></tt> objects (cf. below for the list of
available methods). If relationships (and backrefs) are defined using the
<tt class="docutils literal"><span class="pre">orm.relationship</span></tt> and <tt class="docutils literal"><span class="pre">orm.backref</span></tt> functions, appender queries will
also return custom queries:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="n">house</span> <span class="o">=</span> <span class="n">House</span><span class="o">.</span><span class="n">q</span><span class="o">.</span><span class="n">first</span><span class="p">()</span>
<span class="n">relationship_query</span> <span class="o">=</span> <span class="n">house</span><span class="o">.</span><span class="n">cats</span>   <span class="c"># instance of kit.ext.orm.Query</span>
</pre></div>
</div>
<dl class="class">
<dt id="kit.ext.orm.Query">
<em class="property">class </em><tt class="descclassname">kit.ext.orm.</tt><tt class="descname">Query</tt><big>(</big><em>entities</em>, <em>session=None</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query" title="Permalink to this definition">¶</a></dt>
<dd><p>Base query class.</p>
<p>All queries and relationships/backrefs defined using this extension will
return an instance of this class.</p>
<dl class="method">
<dt id="kit.ext.orm.Query.get_or_404">
<tt class="descname">get_or_404</tt><big>(</big><em>model_id</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.get_or_404"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.get_or_404" title="Permalink to this definition">¶</a></dt>
<dd><p>Like get but aborts with 404 if not found.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>model_id</strong> (<em>varies</em>) &#8211; the model&#8217;s primary key</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">model or HTTPError</td>
</tr>
</tbody>
</table>
<p>This method is from Flask-SQLAlchemy.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Query.first_or_404">
<tt class="descname">first_or_404</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.first_or_404"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.first_or_404" title="Permalink to this definition">¶</a></dt>
<dd><p>Like first but aborts with 404 if not found.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">model or HTTPError</td>
</tr>
</tbody>
</table>
<p>This method is from Flask-SQLAlchemy.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Query.fast_count">
<tt class="descname">fast_count</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.fast_count"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.fast_count" title="Permalink to this definition">¶</a></dt>
<dd><p>Fast counting, bypassing subqueries.</p>
<p>By default SQLAlchemy count queries use subqueries (which are very slow
on MySQL). This method is useful when counting over large numbers of rows
(10k and more), as the following benchmark shows (~250k rows):</p>
<div class="code python highlight-python"><pre>In [1]: %time Cat.q.count()
CPU times: user 0.01 s, sys: 0.00 s, total: 0.01 s
Wall time: 1.36 s
Out[1]: 281992L

In [2]: %time Cat.c.scalar()
CPU times: user 0.00 s, sys: 0.00 s, total: 0.00 s
Wall time: 0.06 s
Out[2]: 281992L</pre>
</div>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Query.random">
<tt class="descname">random</tt><big>(</big><em>n_instances=1</em>, <em>dialect=None</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.random"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.random" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns random model instances.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>n_instances</strong> (<em>int</em>) &#8211; the number of instances to return</li>
<li><strong>dialect</strong> (<em>str</em>) &#8211; the engine dialect (the implementation of random differs
between MySQL and SQLite among others). By default will look up on the
query for the dialect used. If no random function is available for the 
chosen dialect, the fallback implementation uses total row count to 
generate random offsets.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">model instances</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Query.to_dataframe">
<tt class="descname">to_dataframe</tt><big>(</big><em>load_objects=False</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.to_dataframe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.to_dataframe" title="Permalink to this definition">¶</a></dt>
<dd><p>Loads a dataframe with the records from the query and returns it.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>load_objects</strong> (<em>bool</em>) &#8211; whether or not to load the underlying objects. If set
to <tt class="docutils literal"><span class="pre">False</span></tt>, the dataframe will be populated with the contents of
<tt class="docutils literal"><span class="pre">to_json</span></tt> of the models, otherwise it will only contain the columns
existing in the database (default behavior). If lazy is <tt class="docutils literal"><span class="pre">True</span></tt>, this
method also accepts the same keyword arguments as
<a class="reference internal" href="util.html#kit.util.query_to_dataframe" title="kit.util.query_to_dataframe"><tt class="xref py py-func docutils literal"><span class="pre">kit.util.query_to_dataframe()</span></tt></a>. For convenience, if no
<tt class="docutils literal"><span class="pre">exclude</span></tt> kwarg is specified, it will default to <tt class="docutils literal"><span class="pre">['_cache']</span></tt>.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">pandas.DataFrame</td>
</tr>
</tbody>
</table>
<p>Requires the <tt class="docutils literal"><span class="pre">pandas</span></tt> library to be installed.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Query.to_records">
<tt class="descname">to_records</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Query.to_records"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Query.to_records" title="Permalink to this definition">¶</a></dt>
<dd><p>Raw execute of the query into a generator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">generator</td>
</tr>
</tbody>
</table>
<p>This method accepts the same keyword arguments as 
<a class="reference internal" href="util.html#kit.util.query_to_records" title="kit.util.query_to_records"><tt class="xref py py-func docutils literal"><span class="pre">kit.util.query_to_records()</span></tt></a>.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.ext.orm.Model">
<em class="property">class </em><tt class="descclassname">kit.ext.orm.</tt><tt class="descname">Model</tt><a class="reference internal" href="_modules/kit/ext/orm.html#Model"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>The custom model class.</p>
<p>Along with the methods described below, the following conveniences are
provided:</p>
<ul class="simple">
<li>Automatic table naming (to the model&#8217;s class name uncamelcased with an
extra s appended for good measure). To disable this behavior, simply
override the <tt class="docutils literal"><span class="pre">__tablename__</span></tt> argument (setting it to <tt class="docutils literal"><span class="pre">None</span></tt> for
single table inheritance).</li>
<li>Default implementation of <tt class="docutils literal"><span class="pre">__repr__</span></tt> with model class and primary keys</li>
<li>Caching (inherited from <a class="reference internal" href="util.html#kit.util.Cacheable" title="kit.util.Cacheable"><tt class="xref py py-class docutils literal"><span class="pre">kit.util.Cacheable</span></tt></a>). The cache is not
persistent by default.</li>
<li>Logging (inherited from <a class="reference internal" href="util.html#kit.util.Loggable" title="kit.util.Loggable"><tt class="xref py py-class docutils literal"><span class="pre">kit.util.Loggable</span></tt></a>)</li>
</ul>
<dl class="method">
<dt id="kit.ext.orm.Model.get_primary_key">
<tt class="descname">get_primary_key</tt><big>(</big><em>as_tuple=False</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Model.get_primary_key"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model.get_primary_key" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns a dictionary of primary keys for the given model.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>as_tuple</strong> (<em>bool</em>) &#8211; if set to <tt class="docutils literal"><span class="pre">True</span></tt>, this method will return a tuple with
the model&#8217;s primary key values. Otherwise a dictionary is returned.</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict, tuple</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Model.to_json">
<tt class="descname">to_json</tt><big>(</big><em>depth=1</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Model.to_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Serializes the model into a dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>depth</strong> (<em>int</em>) &#8211; </td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p>The following attributes are included in the returned JSON:</p>
<ul class="simple">
<li>all non private columns</li>
<li>all non private properties</li>
<li>all non private relationships which have their <tt class="docutils literal"><span class="pre">lazy</span></tt> attribute set to
one of <tt class="docutils literal"><span class="pre">False,</span> <span class="pre">'joined',</span> <span class="pre">'immediate'</span></tt></li>
</ul>
<p>A consequence of this is that this method will never issue extra queries
to populate the JSON. Furthermore, all the attribute names to be
included are computed at class declaration so this method is very fast.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">To change which attributes are included in the dictionary, you can 
override the <tt class="docutils literal"><span class="pre">__json__</span></tt> attribute.</p>
</div>
</dd></dl>

<dl class="classmethod">
<dt id="kit.ext.orm.Model.retrieve">
<em class="property">classmethod </em><tt class="descname">retrieve</tt><big>(</big><em>from_key=False</em>, <em>flush_if_missing=False</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Model.retrieve"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model.retrieve" title="Permalink to this definition">¶</a></dt>
<dd><p>Given constructor arguments will return a match or create one.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>flush_if_missing</strong> (<em>bool</em>) &#8211; whether or not to create and flush the model if 
created (this can be used to generate its <tt class="docutils literal"><span class="pre">id</span></tt>).</li>
<li><strong>from_key</strong> (<em>bool</em>) &#8211; instead of issuing a filter on kwargs, this will issue
a get query by id using this parameter. Note that in this case, any other
keyword arguments will only be used if a new instance is created.</li>
<li><strong>kwargs</strong> &#8211; constructor arguments</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">varies</p>
</td>
</tr>
</tbody>
</table>
<p>If <tt class="docutils literal"><span class="pre">flush_if_missing</span></tt> is <tt class="docutils literal"><span class="pre">True</span></tt>, this method returns a tuple <tt class="docutils literal"><span class="pre">(model,</span>
<span class="pre">flag)</span></tt> where <tt class="docutils literal"><span class="pre">model</span></tt> is of the corresponding class and <tt class="docutils literal"><span class="pre">flag</span></tt> is
<tt class="docutils literal"><span class="pre">True</span></tt> if the model was just created and <tt class="docutils literal"><span class="pre">False</span></tt> otherwise. If
<tt class="docutils literal"><span class="pre">flush_if_missing</span></tt> is <tt class="docutils literal"><span class="pre">False</span></tt>, this methods simply returns an instance
if found and <tt class="docutils literal"><span class="pre">None</span></tt> otherwise.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Model.delete">
<tt class="descname">delete</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Model.delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>Mark the model for deletion.</p>
<p>It will be removed from the database on the next commit.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.Model.flush">
<tt class="descname">flush</tt><big>(</big><em>merge=False</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#Model.flush"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.Model.flush" title="Permalink to this definition">¶</a></dt>
<dd><p>Add the model to the session and flush.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>merge</strong> (<em>bool</em>) &#8211; if <tt class="docutils literal"><span class="pre">True</span></tt>, will merge instead of add.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.ext.orm.ORM">
<em class="property">class </em><tt class="descclassname">kit.ext.orm.</tt><tt class="descname">ORM</tt><big>(</big><em>session</em>, <em>model_class=None</em>, <em>query_class=&lt;class 'kit.ext.orm.Query'&gt;</em>, <em>persistent_cache=False</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#ORM"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.ORM" title="Permalink to this definition">¶</a></dt>
<dd><p>The main ORM object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>session</strong> (<cite>sqlalchemy.orm.scoped.scoped_session</cite>) &#8211; the session to attach the ORM instance to.</li>
<li><strong>model_class</strong> &#8211; the base model class used by all models in this
extension.</li>
<li><strong>model_class</strong> &#8211; <cite>kit.ext.orm.Model</cite></li>
<li><strong>query_class</strong> &#8211; the base query class used by all queries made on the
session. The session will be reconfigured in place.</li>
<li><strong>query_class</strong> &#8211; <cite>sqlalchemy.orm.Query</cite></li>
<li><strong>persistent_cache</strong> (<em>bool</em>) &#8211; whether or not to store each model&#8217;s cache in the
database. If so, a text column storing the JSON encoded dictionary will
be created.</li>
</ul>
</td>
</tr>
</tbody>
</table>
<dl class="attribute">
<dt id="kit.ext.orm.ORM.Model">
<tt class="descname">Model</tt><em class="property"> = None</em><a class="headerlink" href="#kit.ext.orm.ORM.Model" title="Permalink to this definition">¶</a></dt>
<dd><p>The declarative base generated from the <cite>model_class</cite>. All models in this
ORM extension should inherit from this class.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.ext.orm.ORM.backref">
<tt class="descname">backref</tt><em class="property"> = None</em><a class="headerlink" href="#kit.ext.orm.ORM.backref" title="Permalink to this definition">¶</a></dt>
<dd><p>The backref factory function using <cite>query_class</cite>. If you use
<cite>sqlalchemy.backref</cite> instead, your dynamic queries will not subclass
<cite>query_class</cite>.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.ext.orm.ORM.relationship">
<tt class="descname">relationship</tt><em class="property"> = None</em><a class="headerlink" href="#kit.ext.orm.ORM.relationship" title="Permalink to this definition">¶</a></dt>
<dd><p>The relationship factory function using <cite>query_class</cite>. If you use
<cite>sqlalchemy.relationship</cite> instead, your dynamic queries will not subclass
<cite>query_class</cite>.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.ORM.get_all_models">
<tt class="descname">get_all_models</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#ORM.get_all_models"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.ORM.get_all_models" title="Permalink to this definition">¶</a></dt>
<dd><p>All mapped models.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.orm.ORM.create_all">
<tt class="descname">create_all</tt><big>(</big><em>checkfirst=True</em><big>)</big><a class="reference internal" href="_modules/kit/ext/orm.html#ORM.create_all"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.orm.ORM.create_all" title="Permalink to this definition">¶</a></dt>
<dd><p>Create tables for all mapped models.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>checkfirst</strong> (<em>bool</em>) &#8211; whether or not to check if tables already exist before
creating them.</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

</div>
<div class="section" id="module-kit.ext.api">
<span id="api"></span><h2>API<a class="headerlink" href="#module-kit.ext.api" title="Permalink to this headline">¶</a></h2>
<p>API Extension (requires the ORM extension).</p>
<p>This extension provides a base class to create API views.</p>
<p>Setup is as follows:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="kn">from</span> <span class="nn">kit</span> <span class="kn">import</span> <span class="n">current_project</span> <span class="k">as</span> <span class="n">pj</span>
<span class="kn">from</span> <span class="nn">kit.ext</span> <span class="kn">import</span> <span class="n">API</span>

<span class="n">api</span> <span class="o">=</span> <span class="n">API</span><span class="p">(</span><span class="n">pj</span><span class="p">)</span>

<span class="n">View</span> <span class="o">=</span> <span class="n">api</span><span class="o">.</span><span class="n">View</span>   <span class="c"># the base API view</span>
</pre></div>
</div>
<p>Views can then be created for models as follows:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># Cat is a subclass of kit.ext.orm.Base</span>

<span class="k">class</span> <span class="nc">CatView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

  <span class="n">__model__</span> <span class="o">=</span> <span class="n">Cat</span>
</pre></div>
</div>
<p>This view will create the following hooks:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">/cats</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/cats/&lt;id&gt;</span></tt></li>
</ul>
<p>Another slighly more complex example:</p>
<div class="code python highlight-python"><div class="highlight"><pre><span class="c"># House is a subclass of kit.ext.orm.Base</span>

<span class="k">class</span> <span class="nc">HouseView</span><span class="p">(</span><span class="n">View</span><span class="p">):</span>

  <span class="n">__model__</span> <span class="o">=</span> <span class="n">House</span>

  <span class="n">methods</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;GET&#39;</span><span class="p">,</span> <span class="s">&#39;POST&#39;</span><span class="p">]</span>
  <span class="n">subviews</span> <span class="o">=</span> <span class="p">[</span><span class="s">&#39;cats&#39;</span><span class="p">]</span>
</pre></div>
</div>
<p>This view will create the following hooks:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">/houses</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/houses/&lt;id&gt;</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/houses/&lt;id&gt;/cats</span></tt></li>
<li><tt class="docutils literal"><span class="pre">/houses/&lt;id&gt;/cats/&lt;position&gt;</span></tt></li>
</ul>
<p>These are only two simple ways to add a view. Please refer to the documentation
for <tt class="xref py py-class docutils literal"><span class="pre">kit.ext.api.BaseView</span></tt> for the list of all available options.</p>
<dl class="exception">
<dt id="kit.ext.api.APIError">
<em class="property">exception </em><tt class="descclassname">kit.ext.api.</tt><tt class="descname">APIError</tt><big>(</big><em>code</em>, <em>content</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#APIError"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.APIError" title="Permalink to this definition">¶</a></dt>
<dd><p>Thrown when an API call is invalid.</p>
<p>The following error codes can occur:</p>
<ul class="simple">
<li><tt class="docutils literal"><span class="pre">400</span> <span class="pre">Bad</span> <span class="pre">Request</span></tt> if the request is badly formulated (wrong query
parameters, invalid form data, etc.)</li>
<li><tt class="docutils literal"><span class="pre">403</span> <span class="pre">Forbidden</span></tt> if the request is not authorized by the server</li>
<li><tt class="docutils literal"><span class="pre">404</span> <span class="pre">Not</span> <span class="pre">Found</span></tt> if the request refers to a non-existent resource</li>
</ul>
</dd></dl>

<dl class="class">
<dt id="kit.ext.api.API">
<em class="property">class </em><tt class="descclassname">kit.ext.api.</tt><tt class="descname">API</tt><big>(</big><em>flask_app</em>, <em>url_prefix='api'</em>, <em>parser_options=None</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#API"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.API" title="Permalink to this definition">¶</a></dt>
<dd><p>The main API object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>project</strong> (<em>kit.project.Project</em>) &#8211; the project against which the extension will be registered</li>
<li><strong>url_prefix</strong> (<em>str</em>) &#8211; the blueprint URL prefix</li>
<li><strong>index_view</strong> (<em>bool</em>) &#8211; whether or not to create a splash page for the api</li>
<li><strong>parser_options</strong> (<em>dict</em>) &#8211; dictionary of options to create the default request
<a class="reference internal" href="#kit.ext.api.Parser" title="kit.ext.api.Parser"><tt class="xref py py-class docutils literal"><span class="pre">kit.ext.api.Parser</span></tt></a></li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="kit.ext.api.View">
<em class="property">class </em><tt class="descclassname">kit.ext.api.</tt><tt class="descname">View</tt><a class="reference internal" href="_modules/kit/ext/api.html#View"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View" title="Permalink to this definition">¶</a></dt>
<dd><p>Base API view.</p>
<p>To customize, override the <tt class="docutils literal"><span class="pre">get</span></tt>, <tt class="docutils literal"><span class="pre">post</span></tt>, etc. methods.</p>
<dl class="attribute">
<dt id="kit.ext.api.View.base_url">
<tt class="descname">base_url</tt><em class="property"> = None</em><a class="headerlink" href="#kit.ext.api.View.base_url" title="Permalink to this definition">¶</a></dt>
<dd><p>Base URL (will default to the model&#8217;s tablename).</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.ext.api.View.methods">
<tt class="descname">methods</tt><em class="property"> = frozenset(['GET'])</em><a class="headerlink" href="#kit.ext.api.View.methods" title="Permalink to this definition">¶</a></dt>
<dd><p>Allowed methods.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.ext.api.View.parser">
<tt class="descname">parser</tt><em class="property"> = None</em><a class="headerlink" href="#kit.ext.api.View.parser" title="Permalink to this definition">¶</a></dt>
<dd><p>Request parser.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.ext.api.View.subviews">
<tt class="descname">subviews</tt><em class="property"> = []</em><a class="headerlink" href="#kit.ext.api.View.subviews" title="Permalink to this definition">¶</a></dt>
<dd><p>Which relationship endpoints to create (these allow GET requests).
Can be <tt class="docutils literal"><span class="pre">True</span></tt> (all relationships) or a list of relationship names.
Only relationships with <tt class="docutils literal"><span class="pre">lazy</span></tt> set to <tt class="docutils literal"><span class="pre">'dynamic'</span></tt>, <tt class="docutils literal"><span class="pre">'select'</span></tt> or
<tt class="docutils literal"><span class="pre">True</span></tt> can have subroutes. All eagerly loaded relationships are simply
available directly on the model.</p>
</dd></dl>

<dl class="classmethod">
<dt id="kit.ext.api.View.register_view">
<em class="property">classmethod </em><tt class="descname">register_view</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.register_view"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.register_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Create the URL routes for the view.</p>
<p>Standard <a class="reference internal" href="util.html#kit.util.View" title="kit.util.View"><tt class="xref py py-class docutils literal"><span class="pre">kit.util.View</span></tt></a> implementation plus subview support.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.api.View.get">
<tt class="descname">get</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.get"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.get" title="Permalink to this definition">¶</a></dt>
<dd><p>GET request handler.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.api.View.post">
<tt class="descname">post</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.post"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.post" title="Permalink to this definition">¶</a></dt>
<dd><p>POST request handler.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.api.View.put">
<tt class="descname">put</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.put"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.put" title="Permalink to this definition">¶</a></dt>
<dd><p>PUT request handler.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.api.View.delete">
<tt class="descname">delete</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.delete"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.delete" title="Permalink to this definition">¶</a></dt>
<dd><p>DELETE request handler.</p>
</dd></dl>

<dl class="method">
<dt id="kit.ext.api.View.validate">
<tt class="descname">validate</tt><big>(</big><em>json</em>, <em>model=None</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#View.validate"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.View.validate" title="Permalink to this definition">¶</a></dt>
<dd><p>Validation method.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>json</strong> (<em>dict</em>) &#8211; a dictionary of attributes</li>
<li><strong>model</strong> (<em>None or kit.ext.orm.BaseModel</em>) &#8211; <tt class="docutils literal"><span class="pre">None</span></tt> if it is POST request, and the model instance to be
modified if it is a PUT request.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">bool</p>
</td>
</tr>
</tbody>
</table>
<p>This method is called on each POST and PUT request. Override it to
implement your own validation logic: return <tt class="docutils literal"><span class="pre">True</span></tt> when the input is
valid and <tt class="docutils literal"><span class="pre">False</span></tt> otherwise. Default implementation accepts everything.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.ext.api.Parser">
<em class="property">class </em><tt class="descclassname">kit.ext.api.</tt><tt class="descname">Parser</tt><big>(</big><em>default_depth=1</em>, <em>max_depth=0</em>, <em>default_limit=20</em>, <em>max_limit=0</em>, <em>sep=';'</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#Parser"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.Parser" title="Permalink to this definition">¶</a></dt>
<dd><p>The request parameter parser.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>default_depth</strong> (<em>int</em>) &#8211; the default depth models are jsonified to. <tt class="docutils literal"><span class="pre">0</span></tt> yields 
an empty dictionary</li>
<li><strong>max_depth</strong> (<em>int</em>) &#8211; the maximum depth allowed in a query. <tt class="docutils literal"><span class="pre">0</span></tt> means no limit.</li>
<li><strong>default_limit</strong> (<em>int</em>) &#8211; the default number of results returned per query</li>
<li><strong>max_limit</strong> (<em>int</em>) &#8211; the maximum number of results returned by a query. <tt class="docutils literal"><span class="pre">0</span></tt> 
means no limit.</li>
<li><strong>sep</strong> (<em>str</em>) &#8211; the separator used for filters and sort parameters</li>
</ul>
</td>
</tr>
</tbody>
</table>
<p>This class has a single method :meth:<tt class="docutils literal"><span class="pre">jsonify</span></tt> which is used to parse a
model or collection and return the serialized response.</p>
<dl class="method">
<dt id="kit.ext.api.Parser.jsonify">
<tt class="descname">jsonify</tt><big>(</big><em>data</em>, <em>data_key='data'</em>, <em>meta_key='meta'</em>, <em>include_request=True</em>, <em>include_time=True</em>, <em>include_matches=True</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/ext/api.html#Parser.jsonify"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.ext.api.Parser.jsonify" title="Permalink to this definition">¶</a></dt>
<dd><p>Parses the data and returns the serialized response.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>data</strong> (<em>model or collection</em>) &#8211; data. At this time, only instances, and lists of instances of
<tt class="docutils literal"><span class="pre">kit.util.sqlalchemy.Model</span></tt>, along with instances of 
<tt class="docutils literal"><span class="pre">kit.util.sqlalchemy.Query</span></tt> are valid.</li>
<li><strong>data_key</strong> (<em>str</em>) &#8211; key where the serialized data will go</li>
<li><strong>meta_key</strong> (<em>str</em>) &#8211; key where the metadata will go</li>
<li><strong>include_request</strong> (<em>bool</em>) &#8211; whether or not to include the issued request
information</li>
<li><strong>include_time</strong> (<em>bool</em>) &#8211; whether or not to include processing time</li>
<li><strong>include_matches</strong> (<em>bool</em>) &#8211; whether or not to include the total number of
results from the data (useful if <tt class="docutils literal"><span class="pre">data</span></tt> is a collection)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">Flask response</p>
</td>
</tr>
</tbody>
</table>
<p>Any keyword arguments will be included with the metadata.</p>
</dd></dl>

</dd></dl>

</div>
</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="api.html">Quickstart</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        &#160;&#160;::&#160;&#160;
        <a href="util.html">Utilities</a>&#160;&#160;»
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2013, Matthieu Monsch.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>