<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">


<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    
    <title>Utilities &mdash; Kit 0.2 documentation</title>
    
    <link rel="stylesheet" href="_static/haiku.css" type="text/css" />
    <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="stylesheet" href="_static/print.css" type="text/css" />
    
    <script type="text/javascript">
      var DOCUMENTATION_OPTIONS = {
        URL_ROOT:    './',
        VERSION:     '0.2',
        COLLAPSE_INDEX: false,
        FILE_SUFFIX: '.html',
        HAS_SOURCE:  true
      };
    </script>
    <script type="text/javascript" src="_static/jquery.js"></script>
    <script type="text/javascript" src="_static/underscore.js"></script>
    <script type="text/javascript" src="_static/doctools.js"></script>
    <script type="text/javascript" src="_static/theme_extras.js"></script>
    <link rel="top" title="Kit 0.2 documentation" href="index.html" />
    <link rel="prev" title="Extensions" href="extensions.html" /> 
  </head>
  <body>
      <div class="header"><h1 class="heading"><a href="index.html">
          <span>Kit 0.2 documentation</span></a></h1>
        <h2 class="heading"><span>Utilities</span></h2>
      </div>
      <div class="topnav">
      
        <p>
        «&#160;&#160;<a href="extensions.html">Extensions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>
      <div class="content">
        
        
  <div class="section" id="module-kit.util">
<span id="utilities"></span><h1>Utilities<a class="headerlink" href="#module-kit.util" title="Permalink to this headline">¶</a></h1>
<p>Utility module.</p>
<dl class="function">
<dt id="kit.util.uncamelcase">
<tt class="descclassname">kit.util.</tt><tt class="descname">uncamelcase</tt><big>(</big><em>name</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#uncamelcase"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.uncamelcase" title="Permalink to this definition">¶</a></dt>
<dd><p>Transforms CamelCase to underscore_case.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>name</strong> (<em>str</em>) &#8211; string input</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">str</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="kit.util.to_json">
<tt class="descclassname">kit.util.</tt><tt class="descname">to_json</tt><big>(</big><em>value</em>, <em>depth=1</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#to_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Serialize an object.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>value</strong> (<em>varies</em>) &#8211; the object to be serialized.</li>
<li><strong>depth</strong> (<em>int</em>) &#8211; used when serializing nested objects with a <tt class="docutils literal"><span class="pre">to_json</span></tt>
method. In that case, the <tt class="docutils literal"><span class="pre">depth</span></tt> parameter is decremented by one each
call. This paramater sets the initial value.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">varies</p>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="class">
<dt id="kit.util.Jsonifiable">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">Jsonifiable</tt><a class="reference internal" href="_modules/kit/util.html#Jsonifiable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Jsonifiable" title="Permalink to this definition">¶</a></dt>
<dd><p>JSONification mixin.</p>
<dl class="method">
<dt id="kit.util.Jsonifiable.to_json">
<tt class="descname">to_json</tt><big>(</big><em>depth=1</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#Jsonifiable.to_json"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Jsonifiable.to_json" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns all keys and properties of an instance in a dictionary.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>depth</strong> (<em>int</em>) &#8211; </td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.util.Loggable">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">Loggable</tt><a class="reference internal" href="_modules/kit/util.html#Loggable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Loggable" title="Permalink to this definition">¶</a></dt>
<dd><p>Convenient logging mixin.</p>
<dl class="attribute">
<dt id="kit.util.Loggable.logger">
<tt class="descname">logger</tt><a class="headerlink" href="#kit.util.Loggable.logger" title="Permalink to this definition">¶</a></dt>
<dd><p>The class logger.</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.util.CACHE_REFRESH">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">CACHE_REFRESH</tt><a class="headerlink" href="#kit.util.CACHE_REFRESH" title="Permalink to this definition">¶</a></dt>
<dd><p>CACHE_REFRESH(expiration,)</p>
<dl class="attribute">
<dt id="kit.util.CACHE_REFRESH.expiration">
<tt class="descname">expiration</tt><a class="headerlink" href="#kit.util.CACHE_REFRESH.expiration" title="Permalink to this definition">¶</a></dt>
<dd><p>Alias for field number 0</p>
</dd></dl>

</dd></dl>

<dl class="class">
<dt id="kit.util.Cacheable">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">Cacheable</tt><a class="reference internal" href="_modules/kit/util.html#Cacheable"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Cacheable" title="Permalink to this definition">¶</a></dt>
<dd><p>Mixin to support cacheable properties.</p>
<p>Implements a few cache maintenance utilities as well.</p>
<dl class="method">
<dt id="kit.util.Cacheable.refresh_cache">
<tt class="descname">refresh_cache</tt><big>(</big><em>names=None</em>, <em>expiration=0</em>, <em>remove_deleted=True</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#Cacheable.refresh_cache"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Cacheable.refresh_cache" title="Permalink to this definition">¶</a></dt>
<dd><p>Refresh this instance&#8217;s cached properties.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first last simple">
<li><strong>names</strong> (<em>iterable</em>) &#8211; list of cached property names to refresh. If specified, only
these will be refreshed.</li>
<li><strong>expiration</strong> (<em>int</em>) &#8211; if specified, only properties of age greater than this
value will be refreshed (seconds).</li>
<li><strong>remove_deleted</strong> (<em>bool</em>) &#8211; if <tt class="docutils literal"><span class="pre">True</span></tt>, cached properties that aren&#8217;t defined
but are still present in the cache will be removed (useful especially for
persistent caches)</li>
</ul>
</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="method">
<dt id="kit.util.Cacheable.get_cache_ages">
<tt class="descname">get_cache_ages</tt><big>(</big><big>)</big><a class="headerlink" href="#kit.util.Cacheable.get_cache_ages" title="Permalink to this definition">¶</a></dt>
<dd><p>Get the age of cached values.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Return type:</th><td class="field-body">dict</td>
</tr>
</tbody>
</table>
<p>Properties not yet cached will appear as <tt class="docutils literal"><span class="pre">None</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="kit.util.Cacheable.cached_property">
<em class="property">classmethod </em><tt class="descname">cached_property</tt><big>(</big><em>func</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#Cacheable.cached_property"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.Cacheable.cached_property" title="Permalink to this definition">¶</a></dt>
<dd><p>Decorator that turns a class method into a cached property.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>func</strong> (<em>func</em>) &#8211; bound method to be turned in to a property</td>
</tr>
</tbody>
</table>
<p>A cached property acts similarly to a property but is only computed once
and then stored in the instance&#8217;s <cite>__cache__</cite> attribute along with the time
it was last computed. Subsequent calls will read directly from the cached
value.  To refresh several or all cached properties, use the
<a class="reference internal" href="#kit.util.Cacheable.refresh_cache" title="kit.util.Cacheable.refresh_cache"><tt class="xref py py-meth docutils literal"><span class="pre">refresh_cache()</span></tt></a> method.</p>
<p>Should only be used with methods of classes that inherit from <tt class="docutils literal"><span class="pre">Cacheable</span></tt>.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="kit.util.query_to_models">
<tt class="descclassname">kit.util.</tt><tt class="descname">query_to_models</tt><big>(</big><em>query</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#query_to_models"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.query_to_models" title="Permalink to this definition">¶</a></dt>
<dd><p>Returns the model classes associated with a query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><strong>query</strong> (<em>sqlalchemy.orm.query.Query</em>) &#8211; the query to be executed</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body">list</td>
</tr>
</tbody>
</table>
</dd></dl>

<dl class="function">
<dt id="kit.util.query_to_dataframe">
<tt class="descclassname">kit.util.</tt><tt class="descname">query_to_dataframe</tt><big>(</big><em>query</em>, <em>connection=None</em>, <em>columns=None</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#query_to_dataframe"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.query_to_dataframe" title="Permalink to this definition">¶</a></dt>
<dd><p>Load a Pandas dataframe from an SQLAlchemy query.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> (<em>sqlalchemy.orm.query.Query</em>) &#8211; the query to be executed</li>
<li><strong>connection</strong> (<em>sqlalchemy.engine.base.Connection</em>) &#8211; the connection to use to execute the query. By default
the method will create a new connection using the session&#8217;s bound engine
and properly close it afterwards.</li>
<li><strong>columns</strong> (<em>list</em>) &#8211; a list of column names. If unspecified, the method will use
the table&#8217;s keys from the query&#8217;s metadata. If the passed data do not have
named associated with them, this argument provides names for the columns.
Otherwise this argument indicates the order of the columns in the result
(any names not found in the data will become all-NA columns)</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">pandas.DataFrame</p>
</td>
</tr>
</tbody>
</table>
<p>Any keyword arguments will be forwarded to <cite>pandas.DataFrame.from_records</cite>.
The following are available:</p>
<blockquote>
<div><ul class="simple">
<li>exclude: a list of column names to exclude from the dataframe</li>
<li>index: the column to use as index</li>
<li>coerce_float: Attempt to convert values to non-string, non-numeric
objects (like decimal.Decimal) to floating point.</li>
</ul>
</div></blockquote>
</dd></dl>

<dl class="function">
<dt id="kit.util.query_to_records">
<tt class="descclassname">kit.util.</tt><tt class="descname">query_to_records</tt><big>(</big><em>query</em>, <em>connection=None</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#query_to_records"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.query_to_records" title="Permalink to this definition">¶</a></dt>
<dd><p>Raw execute of the query into a generator.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>query</strong> (<em>sqlalchemy.orm.query.Query</em>) &#8211; the query to be executed</li>
<li><strong>connection</strong> (<em>sqlalchemy.engine.base.Connection</em>) &#8211; the connection to use to execute the query. By default
the method will create a new connection using the session&#8217;s bound engine
and properly close it afterwards.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">generator</p>
</td>
</tr>
</tbody>
</table>
<p>About 5 times faster than loading the objects. Useful if only interested in
raw columns of the model:</p>
<div class="highlight-python"><pre># for ~300k models
In [1]: %time [m.id for s in Model.q]
CPU times: user 48.22 s, sys: 2.62 s, total: 50.84 s
Wall time: 52.19 s
In [2]: %time [m['id'] for s in query_to_records(Model.q)]
CPU times: user 9.12 s, sys: 0.20 s, total: 9.32 s
Wall time: 10.32 s</pre>
</div>
</dd></dl>

<dl class="class">
<dt id="kit.util.JSONEncodedDict">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">JSONEncodedDict</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#JSONEncodedDict"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.JSONEncodedDict" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements dictionary column field type for SQLAlchemy.</p>
<p>This can be used as a Column type during table creation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">some_column_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">JSONEncodedDict</span><span class="p">)</span>
</pre></div>
</div>
<p>It also implements limited  mutability tracking to know when to update the
database: set, del and update actions are tracked. If another method to
update the dictionary is used, it will not automatically flag the
dictionary for update (for example if a deeply nested key is updated).
In such a case, the <tt class="docutils literal"><span class="pre">changed</span></tt> method needs the be called manually
after the operation.</p>
</dd></dl>

<dl class="class">
<dt id="kit.util.JSONEncodedList">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">JSONEncodedList</tt><big>(</big><em>*args</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#JSONEncodedList"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.JSONEncodedList" title="Permalink to this definition">¶</a></dt>
<dd><p>Implements list column field type for SQLAlchemy.</p>
<p>This can be used as a Column type during table creation:</p>
<div class="highlight-python"><div class="highlight"><pre><span class="n">some_column_name</span> <span class="o">=</span> <span class="n">Column</span><span class="p">(</span><span class="n">JSONEncodedList</span><span class="p">)</span>
</pre></div>
</div>
<p>Currently only set, delete, append and extend events are tracked. Others
will require a call to <tt class="docutils literal"><span class="pre">changed</span></tt> to be persisted.</p>
</dd></dl>

<dl class="class">
<dt id="kit.util.View">
<em class="property">class </em><tt class="descclassname">kit.util.</tt><tt class="descname">View</tt><a class="reference internal" href="_modules/kit/util.html#View"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.View" title="Permalink to this definition">¶</a></dt>
<dd><p>Base view implementation that simplifies route registration.</p>
<p>This class is very similar to <tt class="xref py py-class docutils literal"><span class="pre">flask.views.MethodView</span></tt> but goes a 
step further in registering its routes automatically. Rules are specified
through the <a href="#id1"><span class="problematic" id="id2">:prop:`rules`</span></a> property.</p>
<p>Usage:</p>
<div class="highlight-python"><pre>class MyView(View):

  __app__ = flask_app

  rules = {
    '/some_route': ['GET'],
    '/some_route/&lt;some_index&gt;': ['GET', 'POST']
  }

  def get(self, **kwargs):
    if kwargs:
      some_index = kwargs['some_index']
      # we are in the second route case
      # ...
    else:
      # we are in the first route case
      # ...

  def post(self, **kwargs):
    some_index = kwargs['some_index']
    # ...</pre>
</div>
<p>Typically, this view will be generated by the <a class="reference internal" href="#kit.util.make_view" title="kit.util.make_view"><tt class="xref py py-func docutils literal"><span class="pre">make_view()</span></tt></a> function,
which will set the <tt class="docutils literal"><span class="pre">__app__</span></tt> attribute.</p>
<dl class="attribute">
<dt id="kit.util.View.endpoint">
<tt class="descname">endpoint</tt><em class="property"> = None</em><a class="headerlink" href="#kit.util.View.endpoint" title="Permalink to this definition">¶</a></dt>
<dd><p>The view endpoint. This can generally be skipped, it is only used
internally by Flask in the routes dictionary. If not specifies, it will
default to the class&#8217; name uncamelcased.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.util.View.methods">
<tt class="descname">methods</tt><em class="property"> = None</em><a class="headerlink" href="#kit.util.View.methods" title="Permalink to this definition">¶</a></dt>
<dd><p>If specified, only these methods will be allowed. This can be useful if
subclassing views to override the rule methods.</p>
</dd></dl>

<dl class="attribute">
<dt id="kit.util.View.rules">
<tt class="descname">rules</tt><em class="property"> = None</em><a class="headerlink" href="#kit.util.View.rules" title="Permalink to this definition">¶</a></dt>
<dd><p>A dictionary with the rules to create. Each key is the url rule and the
corresponding value a list of methods to accept. E.g.
<tt class="docutils literal"><span class="pre">{'/index/':</span> <span class="pre">['GET'],</span> <span class="pre">'/index/&lt;page&gt;':</span> <span class="pre">['GET',</span> <span class="pre">'PUT']}</span></tt>.</p>
</dd></dl>

<dl class="classmethod">
<dt id="kit.util.View.register_view">
<em class="property">classmethod </em><tt class="descname">register_view</tt><big>(</big><big>)</big><a class="reference internal" href="_modules/kit/util.html#View.register_view"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.View.register_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Attach view to app or blueprint.</p>
<p>Called by the metaclass when the class is created.</p>
</dd></dl>

<dl class="method">
<dt id="kit.util.View.dispatch_request">
<tt class="descname">dispatch_request</tt><big>(</big><em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#View.dispatch_request"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.View.dispatch_request" title="Permalink to this definition">¶</a></dt>
<dd><p>Dispatches requests to the corresponding method name.</p>
<p>Similar to the <tt class="xref py py-class docutils literal"><span class="pre">flask.views.MethodView</span></tt> implementation: GET requests
are passed to <tt class="xref py py-meth docutils literal"><span class="pre">get()</span></tt>, POST to <tt class="xref py py-meth docutils literal"><span class="pre">post()</span></tt>, etc.</p>
</dd></dl>

</dd></dl>

<dl class="function">
<dt id="kit.util.make_view">
<tt class="descclassname">kit.util.</tt><tt class="descname">make_view</tt><big>(</big><em>app</em>, <em>view_class=&lt;class 'kit.util.View'&gt;</em>, <em>view_name='View'</em>, <em>**kwargs</em><big>)</big><a class="reference internal" href="_modules/kit/util.html#make_view"><span class="viewcode-link">[source]</span></a><a class="headerlink" href="#kit.util.make_view" title="Permalink to this definition">¶</a></dt>
<dd><p>Create a base View class bound to the Flask application.</p>
<table class="docutils field-list" frame="void" rules="none">
<col class="field-name" />
<col class="field-body" />
<tbody valign="top">
<tr class="field-odd field"><th class="field-name">Parameters:</th><td class="field-body"><ul class="first simple">
<li><strong>app</strong> (<em>Flask app or blueprint</em>) &#8211; the app (or blueprint) to be bound to</li>
<li><strong>view_class</strong> (<a class="reference internal" href="#kit.util.View" title="kit.util.View"><em>kit.util.View</em></a>) &#8211; base view class</li>
<li><strong>view_name</strong> (<em>str</em>) &#8211; the name of the class created. If multiple base views are
generated, you can specify a different name for each using this argument.</li>
</ul>
</td>
</tr>
<tr class="field-even field"><th class="field-name">Return type:</th><td class="field-body"><p class="first last">kit.util.View</p>
</td>
</tr>
</tbody>
</table>
<p>Any keyword arguments will be added to the class&#8217; dictionary. This is only
provided as a convenience, if many methods are added, it is simpler to
subclass <a class="reference internal" href="#kit.util.View" title="kit.util.View"><tt class="xref py py-class docutils literal"><span class="pre">kit.util.View</span></tt></a> directly rather than use this function.</p>
</dd></dl>

</div>


      </div>
      <div class="bottomnav">
      
        <p>
        «&#160;&#160;<a href="extensions.html">Extensions</a>
        &#160;&#160;::&#160;&#160;
        <a class="uplink" href="index.html">Contents</a>
        </p>

      </div>

    <div class="footer">
        &copy; Copyright 2013, Matthieu Monsch.
      Created using <a href="http://sphinx-doc.org/">Sphinx</a> 1.2b1.
    </div>
  </body>
</html>